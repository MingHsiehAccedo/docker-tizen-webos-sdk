var util=require("util"),async=require("async"),npmlog=require("npmlog"),luna=require("./base/luna"),path=require("path"),novacom=require("./base/novacom");(function(){var a=npmlog;a.heading="deviceInfo";a.level="warn";var e={log:a,systemInfo:function(s,o){if(typeof o!=="function"){throw new Error("Missing completion callback (next="+util.inspect(o)+")")}s=s||{};async.series([e,n],function(e,n){a.verbose("deviceInfo#systemInfo()","err: ",e,"results:",n);o(e,n[1])});function e(e){s.nReplies=1;s.session=new novacom.Session(s.device,e)}function n(e){a.verbose("deviceInfo#systemInfo#_getSystemInfo()");var n=s.session.getDevice();var o=n.lunaAddr.deviceInfoSystem;var r={keys:["modelName","sdkVersion","firmwareVersion","boardType","otaId"],subscribe:false};luna.sendWithoutErrorHandle(s,o,r,function(e,n){a.silly("deviceInfo#systemInfo#_getSystemInfo():","lineObj:",e);var o=e;if(o){o=t(e,r.keys);if(o.length>0){a.verbose("deviceInfo#systemInfo#_getSystemInfo():","success");n(null,o)}else{a.verbose("deviceInfo#systemInfo#_getSystemInfo():","resultValue is empty");a.verbose("deviceInfo#systemInfo#_getSystemInfo(): luna-send command failed"+(e.errorText?" ("+e.errorText+")":e.errorMessage?" ("+e.errorMessage+")":""));i(n)}}else{n(new Error("deviceInfo#systemInfo#_getSystemInfo(): object format error"))}},e)}function t(e,n){a.verbose("deviceInfo#systemInfo#__makeReturnObj()");var o="";for(var r in n){if(e.hasOwnProperty(n[r]))o+=n[r]+" : "+e[n[r]]+"\n"}a.verbose("__makeReturnObj : "+o);return o.trim()}function i(e){a.verbose("deviceInfo#systemInfo#_getConfigs()");var n=s.session.getDevice();var o=n.lunaAddr.deviceInfoConfig;var r={configNames:["tv.model.modelname","tv.nyx.platformVersion","tv.nyx.firmwareVersion","tv.hw.SoCChipType","tv.nyx.tvBroadcastSystem","tv.rmm.grpCodeName"],subscribe:false};luna.sendWithoutErrorHandle(s,o,r,function(e,n){a.silly("deviceInfo#systemInfo#_getConfigs():","lineObj:",e);var o=e;if(o){if(o.returnValue){a.verbose("deviceInfo#systemInfo#_getConfigs():","returnValue is true");if(o.configs){o=f(o.configs);a.verbose("deviceInfo#systemInfo#_getConfigs():","success");n(null,o)}else{a.verbose("deviceInfo#systemInfo#_getConfigs():","configs not exist");n(new Error("deviceInfo#systemInfo#_getConfigs(): luna-send command failed (missingConfigs)"))}}else{a.verbose("deviceInfo#systemInfo#_getConfigs():","failure");n(new Error("deviceInfo#systemInfo#_getConfigs(): luna-send command failed"+(o.errorText?" ("+o.errorText+")":o.errorMessage?" ("+o.errorMessage+")":"")))}}else{n(new Error("deviceInfo#systemInfo#_getConfigs(): object format error"))}},e)}function f(e){a.verbose("deviceInfo#systemInfo#__makeConfigObj()");var n="";if(e.hasOwnProperty("tv.model.modelname")){n+="modelName : "+e["tv.model.modelname"]+"\n"}if(e.hasOwnProperty("tv.nyx.platformVersion")){n+="sdkVersion : "+e["tv.nyx.platformVersion"]+"\n"}if(e.hasOwnProperty("tv.nyx.firmwareVersion")){n+="firmwareVersion : "+e["tv.nyx.firmwareVersion"]+"\n"}var o="";if(e.hasOwnProperty("tv.hw.SoCChipType")){o+=e["tv.hw.SoCChipType"]}if(e.hasOwnProperty("tv.nyx.tvBroadcastSystem")){o+="_"+e["tv.nyx.tvBroadcastSystem"]}if(e.hasOwnProperty("tv.rmm.grpCodeName")){o+="_"+e["tv.rmm.grpCodeName"]}if(o!==""){n+="boardType : "+o+"\n"}a.verbose("__makeConfigObj:",n);return n.trim()}}};if(typeof module!=="undefined"&&module.exports){module.exports=e}})();